# シンプル家計簿アプリ - 実装手順

## 🚀 Phase 1: プロジェクト初期化

### Issue #1: プロジェクトセットアップ ✅ 完了
## タイトル
プロジェクト初期化と開発環境セットアップ

## 説明
Next.js + Express.js + Prisma + Supabaseの開発環境を構築する

## 設計
- Next.js 14（App Router）
- Express.js（API Routes）
- Prisma（ORM）
- Supabase（データベース・認証）
- TypeScript
- ESLint + Prettier

## タスク
- [x] Next.jsプロジェクトの作成
- [x] Express.jsサーバーの設定
- [x] Prismaの初期化
- [x] Supabaseプロジェクトの作成
- [x] 環境変数の設定
- [x] 基本的なディレクトリ構造の作成

## 完了条件
- [x] ローカルでNext.jsアプリが起動する
- [x] Express.jsサーバーが起動する
- [x] PrismaがSupabaseに接続できる

---

### Issue #2: データベーススキーマの実装 ✅ 完了
## タイトル
Prismaスキーマの実装とマイグレーション

## 説明
家計簿アプリに必要なデータベーススキーマを実装し、マイグレーションを実行する

## 設計
- Prisma Schema（データベース定義）
- User（ユーザー）: 認証情報と基本情報
- Category（カテゴリ）: 収入・支出の分類マスター
- Income（収入）: ユーザーとカテゴリに紐づく収入データ
- Expense（支出）: ユーザーとカテゴリに紐づく支出データ
- Savings（貯金）: 共有データ（ユーザーと紐付かない）
- Budget（予算）: 共有データ（ユーザーと紐付かない）

## タスク
- [x] Prismaスキーマファイルの作成
- [x] 各モデルの定義（User, Category, Income, Expense, Savings, Budget）
- [x] リレーションの設定
- [x] 初期マイグレーションの実行
- [x] シードデータの作成（カテゴリマスターデータ）

## 完了条件
- [x] データベーススキーマが正しく作成される
- [x] マイグレーションが成功する
- [x] シードデータが投入される

## 実装詳細
### データベーススキーマ
- **User**: ユーザー情報管理
- **Category**: 収入・支出カテゴリ管理
- **Income**: 収入データ管理（memoフィールド追加済み）
- **Expense**: 支出データ管理
- **Savings**: 貯金データ管理
- **Budget**: 予算データ管理

### シードデータ
- **収入カテゴリ**: 給与、ボーナス、副業、投資収益、家賃収入、臨時収入、その他
- **支出カテゴリ**: 食費、光熱費、交通費、娯楽費、日用品、衣類、医療費、その他

---

## 🔐 Phase 2: 認証機能

### Issue #3: 認証システムの実装 ✅ 完了
## タイトル
Supabase認証機能の実装

## 説明
ユーザーの登録・ログイン機能を実装する

## 設計
- Supabase Auth（認証サービス）
- Next.js Middleware（ルート保護）
- React Context（認証状態管理）
- セッション管理（JWT）
- パスワードリセット機能

## タスク
- [x] Supabase認証の設定
- [x] ユーザー登録画面の作成
- [x] ログイン画面の作成
- [x] ログアウト機能の実装
- [x] 認証状態の管理
- [x] 保護されたルートの実装

## 完了条件
- [x] ユーザーが登録・ログインできる
- [x] 認証状態が適切に管理される
- [x] 未認証ユーザーは保護されたページにアクセスできない

## 実装詳細
### 認証フロー
- **Google OAuth**: Supabase Authを使用
- **JWT トークン**: バックエンドで独自JWT発行
- **Cookie 認証**: httpOnly Cookieによる自動認証
- **セッション管理**: React Contextによる状態管理

### API エンドポイント
- `/api/auth/token` - JWTトークン発行
- `/api/auth/logout` - ログアウト処理
- `/api/auth/me` - 認証状態確認
- `/api/auth/ping` - API疎通確認

---

## 💰 Phase 3: 基本機能の実装

### Issue #4: 収入管理機能の実装 ✅ 完了
## タイトル
収入の登録・編集・削除機能

## 説明
ユーザーが収入を登録・編集・削除できる機能を実装する

## 設計
- React Hook Form（フォーム管理）
- Zod（バリデーション）
- Prisma Client（データ操作）
- SWR（データフェッチング）
- モーダル・ダイアログ（編集・削除確認）

## タスク
- [x] 収入登録フォームの作成
- [x] 収入一覧表示の実装
- [x] 収入編集機能の実装
- [x] 収入削除機能の実装
- [x] カテゴリ選択機能の実装
- [x] バリデーションの実装

## 完了条件
- [x] 収入の登録・編集・削除ができる
- [x] カテゴリが正しく選択できる
- [x] バリデーションが適切に動作する

## 実装詳細
### バックエンド
- **API エンドポイント**: `/api/incomes` (GET, POST, PUT, DELETE)
- **カテゴリ API**: `/api/categories/income` (GET)
- **認証**: JWT認証ミドルウェア
- **バリデーション**: サーバーサイドバリデーション

### フロントエンド
- **ページ**: `/incomes` - 収入管理ページ
- **コンポーネント**: 
  - `IncomeModal` - 収入登録・編集モーダル
  - `DeleteConfirmDialog` - 削除確認ダイアログ
- **フック**: `useIncomes`, `useIncomeCategories` - SWRフック
- **バリデーション**: Zodスキーマによる型安全なバリデーション

### データベース
- **テーブル**: `Income`, `Category`
- **フィールド**: `memo`フィールドを追加
- **シードデータ**: 収入カテゴリの初期データ

---

### Issue #5: 支出管理機能の実装
## タイトル
支出の登録・編集・削除機能

## 説明
ユーザーが支出を登録・編集・削除できる機能を実装する

## 設計
- React Hook Form（フォーム管理）
- Zod（バリデーション）
- Prisma Client（データ操作）
- SWR（データフェッチング）
- テキストエリア（説明文入力）
- カテゴリ選択ドロップダウン

## タスク
- [ ] 支出登録フォームの作成
- [ ] 支出一覧表示の実装
- [ ] 支出編集機能の実装
- [ ] 支出削除機能の実装
- [ ] カテゴリ選択機能の実装
- [ ] 説明文入力機能の実装
- [ ] バリデーションの実装

## 完了条件
- 支出の登録・編集・削除ができる
- カテゴリが正しく選択できる
- 説明文が入力できる
- バリデーションが適切に動作する

---

### Issue #6: 貯金管理機能の実装
## タイトル
貯金の登録・編集・削除機能

## 説明
2人で共有する貯金情報を登録・編集・削除できる機能を実装する

## 設計
- React Hook Form（フォーム管理）
- Zod（バリデーション）
- Prisma Client（データ操作）
- SWR（データフェッチング）
- 共有データ管理（ユーザーと紐付かない）
- 金額入力フォーム（数値バリデーション）

## タスク
- [ ] 貯金登録フォームの作成
- [ ] 貯金一覧表示の実装
- [ ] 貯金編集機能の実装
- [ ] 貯金削除機能の実装
- [ ] バリデーションの実装

## 完了条件
- 貯金の登録・編集・削除ができる
- ユーザーと紐付かない共有データとして管理される
- バリデーションが適切に動作する

---

### Issue #7: 予算管理機能の実装
## タイトル
予算の設定・編集・削除機能

## 説明
外出時の予算を設定・編集・削除できる機能を実装する

## 設計
- React Hook Form（フォーム管理）
- Zod（バリデーション）
- Prisma Client（データ操作）
- SWR（データフェッチング）
- 共有データ管理（ユーザーと紐付かない）
- 用途入力フィールド（テキスト入力）

## タスク
- [ ] 予算設定フォームの作成
- [ ] 予算一覧表示の実装
- [ ] 予算編集機能の実装
- [ ] 予算削除機能の実装
- [ ] 用途入力機能の実装
- [ ] バリデーションの実装

## 完了条件
- 予算の設定・編集・削除ができる
- 用途が正しく入力できる
- ユーザーと紐付かない共有データとして管理される
- バリデーションが適切に動作する

---

## 📊 Phase 4: 分析機能の実装（オプション・デプロイ後）

### Issue #8: 集計機能の実装
## タイトル
日毎・月毎・年毎の収支集計機能

## 説明
収入・支出・貯金の日毎・月毎・年毎の集計を表示する機能を実装する

## 設計
- Prisma Client（集計クエリ）
- SWR（データフェッチング）
- 日付フィルタリング（期間選択）
- ユーザー別・合計集計ロジック
- 数値フォーマット（金額表示）
- レスポンシブテーブル

## タスク
- [ ] 日毎集計の実装
- [ ] 月毎集計の実装
- [ ] 年毎集計の実装
- [ ] ユーザー別集計の実装
- [ ] 合計集計の実装
- [ ] 期間選択機能の実装

## 完了条件
- 各期間の集計が正しく表示される
- ユーザー別・合計の集計が表示される
- 期間選択ができる

---

### Issue #9: グラフ表示機能の実装
## タイトル
収支データの可視化機能

## 説明
収支データを棒グラフ・円グラフで表示する機能を実装する

## 設計
- Chart.js（グラフライブラリ）
- react-chartjs-2（Reactラッパー）
- 棒グラフ（収支推移）
- 円グラフ（ユーザー別・カテゴリ別）
- レスポンシブ対応
- カラーパレット（MoneyForward風）

## タスク
- [ ] 棒グラフライブラリの導入（Chart.js等）
- [ ] 収支推移の棒グラフ実装
- [ ] ユーザー別比較の円グラフ実装
- [ ] カテゴリ別分析のグラフ実装
- [ ] レスポンシブ対応

## 完了条件
- 収支推移が棒グラフで表示される
- ユーザー別比較が円グラフで表示される
- カテゴリ別分析が表示される
- モバイルでも適切に表示される

---

### Issue #10: ダッシュボードの実装
## タイトル
月間サマリーと最近の収支状況表示

## 説明
月間の収支サマリーと最近の収支状況を表示するダッシュボードを実装する

## 設計
- グリッドレイアウト（CSS Grid）
- カードコンポーネント（サマリー表示）
- 残高計算ロジック（収入 - 支出）
- 目標達成率計算
- 最近のデータ表示（最新5件）
- レスポンシブ対応

## タスク
- [ ] 月間サマリーの実装
- [ ] 最近の収支一覧の実装
- [ ] 残高表示の実装
- [ ] 目標達成率の表示
- [ ] ダッシュボードレイアウトの実装

## 完了条件
- 月間サマリーが表示される
- 最近の収支が表示される
- 残高が正しく計算される
- 目標達成率が表示される

---

## 🎨 Phase 5: UI/UX改善

### Issue #11: MoneyForward風UIの実装
## タイトル
MoneyForwardを参考にした直感的なUI実装

## 説明
MoneyForwardを参考にした使いやすいUIを実装する

## 設計
- Tailwind CSS（スタイリング）
- Framer Motion（アニメーション）
- カラーパレット（MoneyForward風）
- コンポーネントライブラリ
- レスポンシブデザイン
- アクセシビリティ対応

## タスク
- [ ] デザインシステムの構築
- [ ] カラーパレットの定義
- [ ] コンポーネントライブラリの作成
- [ ] レスポンシブデザインの実装
- [ ] アニメーションの追加
- [ ] アクセシビリティの改善

## 完了条件
- MoneyForward風の直感的なUI
- レスポンシブ対応
- アクセシビリティ対応
- スムーズなアニメーション

---

## 🔧 Phase 6: 追加機能（オプション・デプロイ後）

### Issue #12: レシート画像解析機能の実装
## タイトル
OCR機能によるレシート画像解析

## 説明
レシート画像からテキストを抽出し、マークダウン形式でリストアップする機能を実装する

## 設計
- Tesseract.js（OCRライブラリ）
- 画像アップロード（ドラッグ&ドロップ）
- テキスト抽出API
- マークダウン変換
- 編集可能なテキストエリア
- エラーハンドリング

## タスク
- [ ] OCRライブラリの導入
- [ ] 画像アップロード機能の実装
- [ ] テキスト抽出機能の実装
- [ ] マークダウン形式での出力
- [ ] 抽出結果の編集機能
- [ ] エラーハンドリング

## 完了条件
- レシート画像からテキストが抽出される
- マークダウン形式で出力される
- 抽出結果を編集できる
- エラーが適切に処理される

---

## 🚀 Phase 7: デプロイ・テスト

### Issue #13: テストの実装
## タイトル
ユニットテスト・統合テストの実装

## 説明
アプリケーションの品質を保証するためのテストを実装する

## 設計
- Jest（テストフレームワーク）
- React Testing Library（コンポーネントテスト）
- Playwright（E2Eテスト）
- テストカバレッジ測定
- CI/CDパイプライン統合
- モック・スタブ（外部依存）

## タスク
- [ ] テスト環境の構築
- [ ] ユニットテストの実装
- [ ] 統合テストの実装
- [ ] E2Eテストの実装
- [ ] テストカバレッジの測定

## 完了条件
- 主要機能のテストが実装される
- テストカバレッジが80%以上
- CI/CDパイプラインでテストが実行される

---

### Issue #14: 本番デプロイ
## タイトル
Vercel・Supabaseへの本番デプロイ

## 説明
アプリケーションを本番環境にデプロイする

## 設計
- Vercel（フロントエンド・API）
- Supabase（データベース・認証）
- 環境変数管理
- ドメイン設定
- SSL証明書（自動）
- パフォーマンス最適化

## タスク
- [ ] Vercelプロジェクトの設定
- [ ] Supabase本番環境の設定
- [ ] 環境変数の設定
- [ ] ドメインの設定
- [ ] SSL証明書の設定
- [ ] パフォーマンス最適化

## 完了条件
- アプリケーションが本番環境で動作する
- ドメインが設定される
- SSL証明書が有効
- パフォーマンスが最適化される

---

## 📋 実装順序の推奨

### MVP（最小限の機能）
1. **Phase 1**: プロジェクト初期化（必須）
2. **Phase 2**: 認証機能（必須）
3. **Phase 3**: 基本機能の実装（必須）
4. **Phase 5**: UI/UX改善（重要）
5. **Phase 7**: デプロイ・テスト（必須）

### 追加開発（デプロイ後）
6. **Phase 4**: 分析機能の実装（オプション）
7. **Phase 6**: 追加機能（オプション）

各Phaseは前のPhaseが完了してから開始することを推奨します。
MVPの機能が完成してデプロイ後、分析機能や追加機能を段階的に実装します。